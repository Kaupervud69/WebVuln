# **Открытое перенаправление (Open URL Redirect)**
> Непроверенные перенаправления и пересылки возможны, когда веб-приложение принимает ненадежные входные данные, которые могут заставить веб-приложение перенаправить запрос на URL, содержащийся в этих ненадежных данных. Изменяя ненадежный URL-ввод на ссылку на вредоносный сайт, пользователь может успешно осуществить фишинговую атаку и украсть учетные данные пользователей. Поскольку имя сервера в измененной ссылке идентично исходному сайту, фишинговые попытки могут выглядеть более заслуживающими доверия. Атаки с использованием непроверенного перенаправления и пересылки также могут быть использованы для вредоносного создания URL-адреса, который пройдет проверку контроля доступа приложения, а затем перенаправит злоумышленника к привилегированным функциям, к которым у него обычно не было бы доступа.

*   [Методология](#Методология)
    *   [Код состояния HTTP-перенаправления](#Коды-состояния-HTTP--перенаправления)
    *   [Методы перенаправления](#Методы-перенаправления)
        *   [Перенаправление на основе пути](#Перенаправление-на-основе-пути)
        *   [Перенаправление на основе JavaScript](#Перенаправление-на-основе-JavaScript)
        *   [Распространенные параметры запроса](#Распространенные-параметры-запроса)
    *   [Обход фильтров](#Обход-фильтров)
*   [Ссылки](#URL)

# Методология

Уязвимость открытого перенаправления возникает, когда веб-приложение или сервер использует непроверенные, предоставленные пользователем данные для перенаправления пользователей на другие сайты. Это позволяет злоумышленнику создать ссылку на уязвимый сайт, которая перенаправляет на выбранный им вредоносный сайт.

**Пример:** Веб-приложение имеет функцию, которая позволяет пользователям нажимать на ссылку и автоматически перенаправляться на сохраненную предпочтительную домашнюю страницу. Это может быть реализовано следующим образом:

```python
https://example.com/redirect?url=https://userpreferredsite.com
```

Пользователь может использовать здесь открытое перенаправление, заменив `userpreferredsite.com` на ссылку на вредоносный веб-сайт. Затем он может распространять эту ссылку в фишинговом письме или на другом веб-сайте. Когда пользователи переходят по ссылке, они попадают на вредоносный сайт.

## Коды состояния HTTP-перенаправления

Коды состояния HTTP-перенаправления, начинающиеся с 3, указывают на то, что клиент должен выполнить дополнительное действие для завершения запроса. Вот некоторые из наиболее распространенных:

*   [300 Multiple Choices](https://httpstatuses.com/300) — Указывает, что на запрос существует более одного возможного ответа. Клиент должен выбрать один из них.
*   [301 Moved Permanently](https://httpstatuses.com/301) — Означает, что запрошенный ресурс был окончательно перемещен по URL, указанному в заголовках `Location`. Все будущие запросы должны использовать новый URI.
*   [302 Found](https://httpstatuses.com/302) — Этот код ответа означает, что запрошенный ресурс был временно перемещен по URL, указанному в заголовках `Location`. В отличие от 301, это не означает, что ресурс перемещен навсегда, а лишь то, что он временно находится в другом месте.
*   [303 See Other](https://httpstatuses.com/303) — Сервер отправляет этот ответ, чтобы указать клиенту получить запрошенный ресурс по другому URI с помощью GET-запроса.
*   [304 Not Modified](https://httpstatuses.com/304) — Используется для целей кэширования. Он сообщает клиенту, что ответ не был изменен, поэтому клиент может продолжать использовать ту же кэшированную версию ответа.
*   [305 Use Proxy](https://httpstatuses.com/305) — Запрошенный ресурс должен быть доступен через прокси, указанный в заголовке `Location`.
*   [307 Temporary Redirect](https://httpstatuses.com/307) — Означает, что запрошенный ресурс был временно перемещен по URL, указанному в заголовках `Location`, и будущие запросы все еще должны использовать исходный URI.
*   [308 Permanent Redirect](https://httpstatuses.com/308) — Означает, что ресурс был окончательно перемещен по URL, указанному в заголовках `Location`, и будущие запросы должны использовать новый URI. Он похож на 301, но не позволяет изменять HTTP-метод.

## Методы перенаправления

### Перенаправление на основе пути

Вместо параметров запроса логика перенаправления может полагаться на путь:

*   Использование слешей в URL: `https://example.com/redirect/http://malicious.com`
*   Внедрение относительных путей: `https://example.com/redirect/../http://malicious.com`

### Перенаправление на основе JavaScript

Если приложение использует JavaScript для перенаправления, пользователь может манипулировать переменными сценария.

**Пример:**
```javascript
var redirectTo = "http://trusted.com";
window.location = redirectTo;
```
**Полезная нагрузка:** `?redirectTo=http://malicious.com`

### Распространенные параметры запроса

*   `?checkout_url={полезная_нагрузка}`
*   `?continue={полезная_нагрузка}`
*   `?dest={полезная_нагрузка}`
*   `?destination={полезная_нагрузка}`
*   `?go={полезная_нагрузка}`
*   `?image_url={полезная_нагрузка}`
*   `?next={полезная_нагрузка}`
*   `?redir={полезная_нагрузка}`
*   `?redirect_uri={полезная_нагрузка}`
*   `?redirect_url={полезная_нагрузка}`
*   `?redirect={полезная_нагрузка}`
*   `?return_path={полезная_нагрузка}`
*   `?return_to={полезная_нагрузка}`
*   `?return={полезная_нагрузка}`
*   `?returnTo={полезная_нагрузка}`
*   `?rurl={полезная_нагрузка}`
*   `?target={полезная_нагрузка}`
*   `?url={полезная_нагрузка}`
*   `?view={полезная_нагрузка}`
*   `/{полезная_нагрузка}`
*   `/redirect/{полезная_нагрузка}`

## Обход фильтров

*   **Использование доверенного домена или ключевого слова в белом списке**
```python
www.доверенный.com.evil.com перенаправляет на evil.com
```
*   **Использование **CRLF** для обхода заблокированного ключевого слова "javascript"**
```python
java%0d%0ascript%0d%0a:alert(0)
```
*   **Использование "`//`" и "`////`" для обхода заблокированного ключевого слова "http"**
```python
//google.com
////google.com
```
*   **Использование "https:" для обхода заблокированного ключевого слова "`//`"**
```python
https:google.com
```
*   **Использование "`\/\/`" для обхода заблокированного ключевого слова "`//`"**
```python
\/\/google.com/
/\/google.com/
```
*   **Использование "`%E3%80%82`" для обхода заблокированного символа "`.`"**
```python
/?redir=google。com
//google%E3%80%82com
```
*   **Использование нулевого байта "`%00`" для обхода фильтра черного списка**
```python
//google%00.com
```
*   **Использование HTTP Parameter Pollution (Загрязнение HTTP-параметров)**
```python
?next=доверенный.com&next=google.com
```
*   **Использование символа "@". Синтаксис общей схемы Интернета**
```python
//<пользователь>:<пароль>@<хост>:<порт>/<путь-url>
http://www.ихсайт.com@вашсайт.com/
```
*   **Создание папки как их домена**
```python
http://www.вашсайт.com/http://www.ихсайт.com/
http://www.вашсайт.com/folder/www.папка.com
```
*   **Использование символа "`?`" — браузер преобразует его в "`/?`"**
```python
http://www.вашсайт.com?http://www.ихсайт.com/
http://www.вашсайт.com?folder/www.папка.com
```
*   **Нормализация хоста/разделителя в Unicode**
```python
https://evil.c℀.example.com ---> https://evil.ca/c.example.com
http://a.com／X.b.com
```

# URL

* [You do not need to run 80 reconnaissance tools to get access to user accounts - Stefano Vettorazzi (@stefanocoding) - May 16, 2019](https://gist.github.com/stefanocoding/8cdc8acf5253725992432dedb1c9c781)
* [Unvalidated Redirects and Forwards Cheat Sheet - OWASP - February 28, 2024](https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet)
* [Host/Split Exploitable Antipatterns in Unicode Normalization - Jonathan Birch - August 3, 2019](https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf)
* [Open Redirect Cheat Sheet - PentesterLand - November 2, 2018](https://pentester.land/cheatsheets/2018/11/02/open-redirect-cheatsheet.html)



