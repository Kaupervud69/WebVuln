**Открытое перенаправление (Open URL Redirect)**
> Непроверенные перенаправления и пересылки возможны, когда веб-приложение принимает ненадежные входные данные, которые могут заставить веб-приложение перенаправить запрос на URL, содержащийся в этих ненадежных данных. Изменяя ненадежный URL-ввод на ссылку на вредоносный сайт, злоумышленник может успешно осуществить фишинговую атаку и украсть учетные данные пользователей. Поскольку имя сервера в измененной ссылке идентично исходному сайту, фишинговые попытки могут выглядеть более заслуживающими доверия. Атаки с использованием непроверенного перенаправления и пересылки также могут быть использованы для вредоносного создания URL-адреса, который пройдет проверку контроля доступа приложения, а затем перенаправит злоумышленника к привилегированным функциям, к которым у него обычно не было бы доступа.

**Краткое содержание**

*   Методология
    *   Код состояния HTTP-перенаправления
    *   Методы перенаправления
        *   Перенаправление на основе пути
        *   Перенаправление на основе JavaScript
        *   Распространенные параметры запроса
    *   Обход фильтров
*   Лабораторные работы
*   Ссылки

**Методология**

Уязвимость открытого перенаправления возникает, когда веб-приложение или сервер использует непроверенные, предоставленные пользователем данные для перенаправления пользователей на другие сайты. Это позволяет злоумышленнику создать ссылку на уязвимый сайт, которая перенаправляет на выбранный им вредоносный сайт.

Злоумышленники могут использовать эту уязвимость в фишинговых кампаниях, для кражи сессий или принуждения пользователя к выполнению действия без его согласия.

**Пример:** Веб-приложение имеет функцию, которая позволяет пользователям нажимать на ссылку и автоматически перенаправляться на сохраненную предпочтительную домашнюю страницу. Это может быть реализовано следующим образом:

`https://example.com/redirect?url=https://userpreferredsite.com`

Злоумышленник может использовать здесь открытое перенаправление, заменив `userpreferredsite.com` на ссылку на вредоносный веб-сайт. Затем он может распространять эту ссылку в фишинговом письме или на другом веб-сайте. Когда пользователи переходят по ссылке, они попадают на вредоносный сайт.

**Коды состояния HTTP-перенаправления**

Коды состояния HTTP-перенаправления, начинающиеся с 3, указывают на то, что клиент должен выполнить дополнительное действие для завершения запроса. Вот некоторые из наиболее распространенных:

*   **300 Multiple Choices** — Указывает, что на запрос существует более одного возможного ответа. Клиент должен выбрать один из них.
*   **301 Moved Permanently** — Означает, что запрошенный ресурс был окончательно перемещен по URL, указанному в заголовках `Location`. Все будущие запросы должны использовать новый URI.
*   **302 Found** — Этот код ответа означает, что запрошенный ресурс был временно перемещен по URL, указанному в заголовках `Location`. В отличие от 301, это не означает, что ресурс перемещен навсегда, а лишь то, что он временно находится в другом месте.
*   **303 See Other** — Сервер отправляет этот ответ, чтобы указать клиенту получить запрошенный ресурс по другому URI с помощью GET-запроса.
*   **304 Not Modified** — Используется для целей кэширования. Он сообщает клиенту, что ответ не был изменен, поэтому клиент может продолжать использовать ту же кэшированную версию ответа.
*   **305 Use Proxy** — Запрошенный ресурс должен быть доступен через прокси, указанный в заголовке `Location`.
*   **307 Temporary Redirect** — Означает, что запрошенный ресурс был временно перемещен по URL, указанному в заголовках `Location`, и будущие запросы все еще должны использовать исходный URI.
*   **308 Permanent Redirect** — Означает, что ресурс был окончательно перемещен по URL, указанному в заголовках `Location`, и будущие запросы должны использовать новый URI. Он похож на 301, но не позволяет изменять HTTP-метод.

**Методы перенаправления**

**Перенаправление на основе пути**

Вместо параметров запроса логика перенаправления может полагаться на путь:

*   Использование слешей в URL: `https://example.com/redirect/http://malicious.com`
*   Внедрение относительных путей: `https://example.com/redirect/../http://malicious.com`

**Перенаправление на основе JavaScript**

Если приложение использует JavaScript для перенаправления, злоумышленники могут манипулировать переменными сценария.

**Пример:**

var redirectTo = "http://trusted.com";
window.location = redirectTo;

**Полезная нагрузка:** `?redirectTo=http://malicious.com`

**Распространенные параметры запроса**

*   `?checkout_url={полезная_нагрузка}`
*   `?continue={полезная_нагрузка}`
*   `?dest={полезная_нагрузка}`
*   `?destination={полезная_нагрузка}`
*   `?go={полезная_нагрузка}`
*   `?image_url={полезная_нагрузка}`
*   `?next={полезная_нагрузка}`
*   `?redir={полезная_нагрузка}`
*   `?redirect_uri={полезная_нагрузка}`
*   `?redirect_url={полезная_нагрузка}`
*   `?redirect={полезная_нагрузка}`
*   `?return_path={полезная_нагрузка}`
*   `?return_to={полезная_нагрузка}`
*   `?return={полезная_нагрузка}`
*   `?returnTo={полезная_нагрузка}`
*   `?rurl={полезная_нагрузка}`
*   `?target={полезная_нагрузка}`
*   `?url={полезная_нагрузка}`
*   `?view={полезная_нагрузка}`
*   `/{полезная_нагрузка}`
*   `/redirect/{полезная_нагрузка}`

**Обход фильтров**

*   **Использование доверенного домена или ключевого слова в белом списке**
    `www.доверенный.com.evil.com` перенаправляет на `evil.com`

*   **Использование CRLF для обхода заблокированного ключевого слова "javascript"**
    `java%0d%0ascript%0d%0a:alert(0)`

*   **Использование "//" и "////" для обхода заблокированного ключевого слова "http"**
    `//google.com`
    `////google.com`

*   **Использование "https:" для обхода заблокированного ключевого слова "//"**
    `https:google.com`

*   **Использование "\/\/" для обхода заблокированного ключевого слова "//"**
    `\/\/google.com/`
    `/\/google.com/`

*   **Использование "%E3%80%82" для обхода заблокированного символа "."**
    `/?redir=google。com`
    `//google%E3%80%82com`

*   **Использование нулевого байта "%00" для обхода фильтра черного списка**
    `//google%00.com`

*   **Использование HTTP Parameter Pollution (Загрязнение HTTP-параметров)**
    `?next=доверенный.com&next=google.com`

*   **Использование символа "@". Синтаксис общей схемы Интернета**
    `//<пользователь>:<пароль>@<хост>:<порт>/<путь-url>`
    `http://www.ихсайт.com@вашсайт.com/`

*   **Создание папки как их домена**
    `http://www.вашсайт.com/http://www.ихсайт.com/`
    `http://www.вашсайт.com/folder/www.папка.com`

*   **Использование символа "?" — браузер преобразует его в "/?"**
    `http://www.вашсайт.com?http://www.ихсайт.com/`
    `http://www.вашсайт.com?folder/www.папка.com`

*   **Нормализация хоста/разделителя в Unicode**
    `https://evil.c℀.example.com` ---> `https://evil.ca/c.example.com`
    `http://a.com／X.b.com`
