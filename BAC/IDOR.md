> **Небезопасные прямые ссылки на объекты (IDOR)** — это уязвимость безопасности, которая возникает, когда приложение позволяет пользователям напрямую получать доступ или изменять объекты (такие как файлы, записи базы данных или URL-адреса) на основе вводимых пользователем данных без достаточного контроля доступа. Это означает, что если пользователь изменит значение параметра (например, ID) в URL-адресе или запросе API, он может получить доступ к данным или манипулировать ими, которые он не авторизован просматривать или изменять.

* [Инструменты](#инструменты)
* [Методология](#методология)
    * [Числовой параметр](#числовой-параметр)
    * [Распространенный идентификатор в качестве параметра](#распространенный-идентификатор-в-качестве-параметра)
    * [Слабый генератор псевдослучайных чисел](#слабый-генератор-псевдослучайных-чисел)
    * [Хешированный параметр](#хешированный-параметр)
    * [Параметр с подстановочными знаками](#параметр-с-подстановочными-знаками)
    * [Советы по поиску IDOR](#советы-по-поиску-idor)

# Инструменты

* [PortSwigger/BApp Store > **Authz**](https://portswigger.net/bappstore/4316cc18ac5f434884b2089831c7d19e)
* [PortSwigger/BApp Store > **AuthMatrix**](https://portswigger.net/bappstore/30d8ee9f40c041b0bfec67441aad158e)
* [PortSwigger/BApp Store > **Autorize**](https://portswigger.net/bappstore/f9bbac8c4acf4aefa4d7dc92a991af2f)

# Методология

**IDOR** расшифровывается как Insecure Direct Object Reference (Небезопасная прямая ссылка на объект). Это тип уязвимости безопасности, который возникает, когда приложение предоставляет прямой доступ к объектам на основе вводимых пользователем данных. В результате злоумышленники могут обойти авторизацию и напрямую получить доступ к ресурсам в системе, что потенциально может привести к несанкционированному раскрытию, изменению или удалению информации.

**Пример IDOR:**

Представьте веб-приложение, которое позволяет пользователям просматривать свой профиль, переходя по ссылке `https://example.com/profile?user_id=123`:

```php
<?php
    $user_id = $_GET['user_id'];
    $user_info = get_user_info($user_id);
...
```
Здесь user_id=123 является прямой ссылкой на профиль конкретного пользователя. Если приложение не проверяет должным образом, что вошедший в систему пользователь имеет право на просмотр профиля, связанного с user_id=123, злоумышленник может просто изменить параметр user_id, чтобы просмотреть профили других пользователей:
```
https://example.com/profile?user_id=124
```

## Числовой параметр

Увеличивайте и уменьшайте эти значения для доступа к конфиденциальной информации.

* Десятичное значение: ```287789, 287790, 287791, ...```
* Шестнадцатеричное: ```0x4642d, 0x4642e, 0x4642f, ...```
* Временная метка Unix epoch: ```1695574808, 1695575098, ...```

Примеры:

* [HackerOne - IDOR to view User Order Information - meals](https://hackerone.com/reports/287789)
* [HackerOne - Delete messages via IDOR - naaash](https://hackerone.com/reports/697412)

## Распространенный идентификатор в качестве параметра

Некоторые идентификаторы можно угадать, например имена и адреса электронной почты; они могут предоставить вам доступ к данным клиентов.

* Имя: ```john, doe, john.doe, ...```
* Email: ```john.doe@mail.com```
* Значение в кодировке Base64: ```am9obi5kb2VAbWFpbC5jb20=```

Пример:

* [HackerOne - Insecure Direct Object Reference (IDOR) - Delete Campaigns - datph4m](https://hackerone.com/reports/1969141)

## Слабый генератор псевдослучайных чисел

* UUID/GUID v1 можно предсказать, если известно время их создания: 95f6e264-bb00-11ec-8833-00155d01ef00
* MongoDB Object Id генерируются предсказуемым образом: 5ae9b90a2c144b9def01ec37
  * 4-байтовое значение, представляющее секунды с начала эпохи Unix
  * 3-байтовый идентификатор машины
  * 2-байтовый идентификатор процесса (PID)
  * 3-байтовый счетчик, начинающийся со случайного значения

Примеры:

* [HackerOne - IDOR allowing to read another user's token on the Social Media Ads service - a_d_a_m](https://hackerone.com/reports/1464168)
* [IDOR through MongoDB Object IDs Prediction](https://techkranti.com/idor-through-mongodb-object-ids-prediction/)

## Хешированный параметр

Иногда мы видим веб-сайты, использующие хешированные значения для генерации случайного идентификатора пользователя или токена, например sha1(username), md5(email), ...

* MD5: ```098f6bcd4621d373cade4e832627b4f6```
* SHA1: ```a94a8fe5ccb19ba61c4c0873d391e987982fbbd3```
* SHA2: ```9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08```

Пример:

* [IDOR with Predictable HMAC Generation - DiceCTF 2022 - CryptoCat](https://youtu.be/Og5_5tEg6M0)

## Параметр с подстановочными знаками

Отправьте подстановочный знак (*, %, ., _) вместо идентификатора. Некоторые бэкенды могут ответить данными всех пользователей.

```python
GET /api/users/* HTTP/1.1
GET /api/users/% HTTP/1.1
GET /api/users/_ HTTP/1.1
GET /api/users/. HTTP/1.1
```

## Советы по поиску IDOR

* Измените HTTP-метод запроса: POST → PUT    
* Измените тип содержимого (Content-Type): XML → JSON
* Преобразуйте числовые значения в массивы: {"id":19} → {"id":[19]}
* Используйте загрязнение параметров (Parameter Pollution): user_id=hacker_id&user_id=victim_id
