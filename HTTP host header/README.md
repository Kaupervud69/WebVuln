### **HTTP_HOST_header_attack**
* **Описание**
	Атаки заголовка HTTP Host используют уязвимые веб-сайты, которые обрабатывают значение заголовка Host небезопасным способом. Если сервер неявно доверяет заголовку Host и не может должным образом проверить или экранировать его, злоумышленник может использовать эти входные данные для внедрения вредоносных полезных нагрузок, которые манипулируют поведением на стороне сервера. Атаки, включающие внедрение полезной нагрузки непосредственно в заголовок Host, часто называются атаками «Host header injection».
	Значение заголовка также может использоваться в различных взаимодействиях между различными системами инфраструктуры веб-сайта.

* **POC**
*	Укажите произвольный заголовок Host
Иногда вы все равно сможете получить доступ к целевому веб-сайту, даже если предоставите неожиданный заголовок Host. Это может быть по ряду причин. Например, серверы иногда настраиваются с параметром по умолчанию или резервным вариантом на случай, если они получат запросы на доменные имена, которые они не распознают. Если ваш целевой веб-сайт окажется сайтом по умолчанию, вам повезло. В этом случае вы можете начать изучать, что приложение делает с заголовком Host и является ли это поведение эксплуатируемым.
С другой стороны, поскольку заголовок Host является такой фундаментальной частью работы веб-сайтов, его изменение часто означает, что вы вообще не сможете связаться с целевым приложением. Фронтенд-сервер или балансировщик нагрузки, получивший ваш запрос, может просто не знать, куда его переслать, что приведет к ошибке «Недопустимый заголовок Host». Это особенно вероятно, если доступ к вашей цели осуществляется через CDN.
*	Проверьте наличие некорректной проверки
Некоторые алгоритмы анализа исключают порт из заголовка Host, что означает, что проверяется только доменное имя. Если вы также можете указать нечисловой порт, вы можете оставить доменное имя нетронутым, чтобы гарантировать, что вы достигнете целевого приложения, при этом потенциально внедрив полезную нагрузку через порт.
*	Отправка неоднозначных запросов
+ Внедрение дублирующих заголовков Host
 GET /example HTTP/1.1
Хост: affected-website.com
Хост: bad-stuff-here
+ Укажите абсолютный URL
 GET https://vulnerable-website.com/ HTTP/1.1
Host: bad-stuff-here
+ Добавьте перенос строк
GET /example HTTP/1.1
	Хост: bad-stuff-here
Хост: уязвимый-website.com
* Вставка заголовков переопределения хоста
Когда присутствует заголовок X-Forwarded-Host, многие фреймворки будут ссылаться на него вместо этого. Вы можете наблюдать такое поведение, даже если нет фронтенда, который использует этот заголовок.
Иногда вы можете использовать X-Forwarded-Host для внедрения вредоносного ввода, обходя любую проверку самого заголовка Host.
GET /example HTTP/1.1
Host: affected-website.com
X-Forwarded-Host: bad-stuff-here
Хотя X-Forwarded-Host является фактическим стандартом для такого поведения, вы можете столкнуться с другими заголовками, которые служат аналогичной цели, включая:
X-Host
X-Forwarded-Server
X-HTTP-Host-Override
Forwarded

* **Профит**
Поскольку заголовок Host фактически контролируется пользователем, эта практика может привести к ряду проблем. Если входные данные не экранированы или не проверены должным образом, заголовок Host является потенциальным вектором для эксплуатации ряда других уязвимостей, в частности:
* Отравление веб-кэша
* Ошибки бизнес-логики в определенных функциях
* SSRF на основе маршрутизации
* Классические уязвимости на стороне сервера, такие как SQL-инъекция
* Отравление сброса пароля

* **Защита**
* Защита абсолютных URL
Когда вам нужно использовать абсолютные URL, вам следует потребовать, чтобы текущий домен был вручную указан в файле конфигурации, и ссылаться на это значение вместо заголовка Host. Такой подход устранит угрозу отравления сброса пароля, например.
* Проверка заголовка Host
Если вам необходимо использовать заголовок Host, убедитесь, что вы правильно его проверяете. Это должно включать проверку его по белому списку разрешенных доменов и отклонение или перенаправление любых запросов на нераспознанные хосты. Вам следует обратиться к документации вашего фреймворка за руководством о том, как это сделать. Например, фреймворк Django предоставляет параметр ALLOWED_HOSTS в файле настроек. Такой подход снизит вашу подверженность атакам с внедрением заголовков хоста.
* Не поддерживайте заголовки переопределения хоста
Также важно проверить, что вы не поддерживаете дополнительные заголовки, которые могут использоваться для создания этих атак, в частности X-Forwarded-Host. Помните, что они могут поддерживаться по умолчанию.
* Белый список разрешенных доменов
Чтобы предотвратить атаки на внутреннюю инфраструктуру на основе маршрутизации, вам следует настроить балансировщик нагрузки или любые обратные прокси-серверы для пересылки запросов только в белый список разрешенных доменов.
* Будьте осторожны с виртуальными хостами только для внутренних целей
При использовании виртуального хостинга вам следует избегать размещения веб-сайтов и приложений только для внутренних целей на том же сервере, что и общедоступный контент. В противном случае злоумышленники смогут получить доступ к внутренним доменам с помощью манипуляции заголовками хоста.
