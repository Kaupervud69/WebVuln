### **CSRF(client)**

* **Описание**
	CSRF — Cross-Site Request Forgery, подделка межсайтовых запросов. Уязвимость, при которой злоумышленник может незаметно заставить жертву выполнить нежелательные действия в веб-приложении, где она уже аутентифицирована.
	
* **Как тестировать**

- Проверь, где хранится CSRF-токен. Если он хранится в куки, приложение уязвимо.
- Выполни запрос с неверным CSRF-токеном — замени символ в своём токене. Иногда разработчики не проверяют его валидность.
- Отправь запрос без CSRF-токена. Приложения не всегда проверяют его наличие.
- Подставь в запрос валидный токен другого пользователя. Достаточно подставить в PoC свой собственный CSRF-токен. Если токен не привязан к сессии пользователя, сервис выполнит такой запрос.
- Если в запросе сложный формат данных, замени его на простой. Например, вместо `Content-Type: application/json` отправь ****`Content-Type: application/x-www-form-urlencoded`. Высока вероятность, что сервер некорректно обрабатывает тип данных. Тогда запрос завершится успешно.
- Поищи другие запросы, которые могут заинтересовать злоумышленника. Возможно, в них нет CSRF-токена. Обращай внимание и на GET-запросы.

----------------Точки входа

* **POC**
* Значения `SameSite`
- `None`: браузер отправляет куки с любым запросом — вне зависимости от его источника. Это используют в основном для межсайтовой навигации.
- `Strict`: куки отправляют, только если сайт, которому предназначен запрос, совпадает с сайтом, который указан в адресной строке. К межсайтовым запросам куки не добавляют.
- `Lax`: куки добавляют к запросам, которые инициированы тем же сайтом; и в некоторых других случаях — например, если переход по ссылке на другой домен использует метод GET.
Если у куки значение `SameSite` не установлено:
- браузер будет обрабатывать её как куки со значением `Lax`,
- в первые 120 секунд все ограничения игнорируются.
* Cookie
1. **Авторизационный токен хранится в куки.** На клиентской стороне есть три хранилища данных: куки, `localStorage` и `sessionStorage`. Сайты по-разному распределяют данные между ними. Авторизационный токен обычно хранят в куках, реже — в `localStorage`, почти никогда — в `sessionStorage`. Только куки браузер автоматически прикладывает к запросам.
2. **Есть действие, которое интересно злоумышленнику.** Это любое действие, которое изменяет состояние сервера и может принести выгоду. Например, смена пароля или почты, отправка сообщения, денежный перевод.
3. **Данные в запросе передаются в простом формате.** Условие связано с CORS — это механизм безопасности браузера, который регулирует запросы ресурсов с одного домена на другой. Если формат данных сложный, то и сам запрос сложный. Сложные запросы браузер не пропустит без OPTIONS — предварительного запроса для проверки разрешения на запрос с другого домена. По умолчанию считаем, что CORS на атакуемом сайте не настроен. Значит, запрос до него не дойдёт, и атака не сорвётся.
4. **Сервер не ждёт в запросе энтропийный параметр, который неизвестен злоумышленнику.** Энтропийный параметр — это CSRF-токен. Это случайное значение, которое сложно угадать или забрутфорсить. Сервер использует его для аутентификации наравне с авторизационным токеном. Самая эффективная защита от CSRF.



* **Профит**
	- Захват аккаунта в приложениях с возможностью управления деньгами.
	- Захват аккаунта с критичными персональными данными.
	- Подделка запроса на выполнение критичного действия — например, перевода денег.
	
----------------Защита

----------------Обход защиты
