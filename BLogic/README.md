* [Как искать уязвимости бизнес-логики](#Как-искать-уязвимости-бизнес-логики)
* [Типы уязвимостей BAC](#Типы-уязвимостей-BAC)
	* [Чрезмерное доверие к клиентским элементам управления](#Чрезмерное-доверие-к-клиентским-элементам-управления)
	* [Неспособность обрабатывать нестандартные входные данные](#Неспособность-обрабатывать-нестандартные-входные-данные)
	* [Ошибочные предположения о поведении пользователе](#Ошибочные-предположения-о-поведении-пользователе)
	* [Недостатки, специфичные для домена](#Недостатки,-специфичные-для-домена)

   		* Тестирование функций обзора
     		* Тестирование функции кодов скидок
       		* Манипуляция со стоимостью доставки
         	* Валютный арбитраж
          	* Эксплуатация премиум-функций
          	* Эксплуатация функции возврата средств
          	* Эксплуатация корзины/списка желаний
          	* Тестирование комментариев в теме 
	* [Предоставление оракула шифрования](#Предоставление-оракула-шифрования)
	* [Несоответствия парсера адресов электронной почты](#Несоответствия-парсера-адресов-электронной-почты)
* [Защита](#Защита)
* [URL](#URL)


# **Business Logic Errors**

* **Уязвимости бизнес-логики** — это недостатки в разработке и реализации приложения, которые позволяют злоумышленнику вызывать непреднамеренное поведение. Это потенциально позволяет злоумышленникам манипулировать законной функциональностью для достижения вредоносной цели. Эти недостатки, как правило, являются результатом неспособности предвидеть необычные состояния приложения, которые могут возникнуть, и, следовательно, неспособности безопасно их обрабатывать.

# **Как искать уязвимости бизнес-логики**

* Изучить бизнес-логику приложения: провести обзор функциональности приложения, понять его цель и основные процессы.  
* Проанализировать архитектуру веб\-приложения: изучить структуру приложения, включая взаимодействие клиентской и серверной частей, доступ к базам данных и хранилищам.  
* Изучить входные данные: проверить, как приложение обрабатывает и валидирует входные данные, искать возможные слабые места в логике обработки этих данных.  
* Использовать бизнес-кейсы: создать различные сценарии использования приложения, чтобы проверить, как приложение реагирует на различные ситуации и какие уязвимости могут проявиться в процессе.  
* Использовать автоматизированные инструменты для сканирования и анализа бизнес-логики приложения на наличие уязвимостей.

# **Типы уязвимостей Business Logic**

### Чрезмерное доверие к клиентским элементам управления

> Принципиально ошибочное предположение заключается в том, что пользователи будут взаимодействовать с приложением только через предоставленный веб-интерфейс.

### Неспособность обрабатывать нестандартные входные данные

> Ввести данные в диапазонах, которые легитимные пользователи вряд ли когда-либо введут.(высокие или исключительно числовые входные данные и необычно длинные строки для текстовых полей, неожиданные типы данных.) 

* Наблюдая за реакцией приложения, следует попытаться ответить на следующие вопросы:
	* Существуют ли какие-либо ограничения, налагаемые на данные?
	* Что происходит, когда вы достигаете этих ограничений?
	* Выполняется ли какое-либо преобразование или нормализация ваших входных данных?

1. Уязвимость логики высокого уровня - Нет параметра цены price, с которым можно проводить манипуляции, но есть параметр количества quantity. Изменить его значение на -1.
2. Недостаток логики низкого уровня - Цена превысила максимально допустимое значение для целого числа в языке программирования бэкэнда (2 147 483 647). В результате значение вернулось к минимально возможному значению (-2 147 483 648)
3. Непоследовательная обработка исключительных входных данных - Убедитесь, что very-long-string содержит правильное количество символов, чтобы «m» в конце @evilcorp.com было ровно 255 символов.
4. Необходимо указать значение от 1 до 999 - Указываем 1e6 и получаем 1.000.000 на балансе

### Ошибочные предположения о поведении пользователей

* Непоследовательные элементы управления безопасностью

* Доверенные пользователи не всегда будут заслуживать доверия

* Пользователи не всегда будут следовать предполагаемой последовательности - Чтобы выявить такие недостатки, следует использовать принудительный просмотр для отправки запросов в непреднамеренной последовательности. Например, вы можете пропустить определенные шаги, получить доступ к одному шагу более одного раза, вернуться к более ранним шагам и т. д. Обратите внимание на то, как осуществляется доступ к разным шагам.

* Пользователи не всегда вводят обязательные данные - При проверке логических ошибок следует попробовать удалить каждый параметр по очереди и посмотреть, как это повлияет на ответ.
  	* Удалить только один параметр за раз, чтобы гарантировать достижение всех соответствующих путей кода.
	* Удалить имя параметра, а также значение. Сервер обычно обрабатывает оба случая по-разному.
	* Выполнить многоэтапные процессы до завершения. Иногда изменение параметра на одном этапе может повлиять на другой шаг далее в рабочем процессе.
Это относится как к параметрам URL, так и к параметрам POST, также проверить файлы cookie. Этот простой процесс может выявить странное поведение приложения, которое может быть использовано.

### Недостатки, специфичные для домена

* **Методология**
  
- Тестирование функций обзора
	- Оцените, можете ли вы опубликовать обзор продукта как проверенный рецензент, не купив его.
	- Попытайтесь указать оценку, выходящую за рамки стандартной шкалы, например, 0, 6 или отрицательное число по шкале от 1 до 5.
	- Проверьте, может ли один и тот же пользователь опубликовать несколько оценок для одного продукта. Это полезно для выявления потенциальных состояний гонки.
	- Определите, допускает ли поле загрузки файла все расширения; разработчики часто игнорируют меры защиты на этих конечных точках.
	- Изучите возможность публикации отзывов от имени других пользователей. Попробуйте использовать подделку межсайтовых запросов (CSRF) в этой функции, так как она часто не защищена токенами.

- Тестирование функции кодов скидок
	- Попробуйте применить один и тот же код скидки несколько раз, чтобы оценить его возможность повторного использования.
	- Если код скидки уникален, проверьте наличие условий гонки, применив один и тот же код для двух учётных записей одновременно.
	- Протестируйте массовое назначение или загрязнение HTTP-параметров, чтобы определить, можно ли применить несколько кодов скидок, если приложение предназначено для приёма только одного.
	- Протестируйте эту функцию на наличие уязвимостей, связанных с отсутствием очистки входных данных, таких как XSS и SQL-инъекции.
	- Попытайтесь применить коды скидок к товарам без скидки, манипулируя запросом на стороне сервера.

- Манипуляция со стоимостью доставки
	- Поэкспериментируйте с отрицательными значениями стоимости доставки, чтобы увидеть, уменьшит ли это итоговую сумму.
	- Оцените, можно ли активировать бесплатную доставку, изменив параметры.

- Валютный арбитраж
	- Попробуйте заплатить в одной валюте, например, в долларах США, и запросить возврат в другой, например, в евро. Разница в курсах конвертации может привести к получению прибыли.

- Эксплуатация премиум-функций
	- Изучите возможность доступа к разделам или конечным точкам, доступным только для премиум-аккаунта, без действующей подписки.
	- Приобретите премиум-функцию, отмените её и проверьте, сможете ли вы использовать её после возврата средств.
	- Ищите значения «истина/ложь» в запросах/ответах, подтверждающих премиум-доступ. Используйте такие инструменты, как Burp Match & Replace, чтобы изменить эти значения для несанкционированного премиум-доступа.
	- Проверьте файлы cookie или локальное хранилище на наличие переменных, подтверждающих премиум-доступ.

- Эксплуатация функции возврата средств
	- Купите товар, запросите возврат средств и проверьте, остался ли товар доступным.
	- Ищите возможности для валютного арбитража.
	- Отправьте несколько запросов на отмену подписки, чтобы проверить возможность нескольких возвратов средств.

- Эксплуатация корзины/списка желаний
	- Протестируйте систему, добавляя товары в отрицательных количествах вместе с другими товарами, чтобы сбалансировать общую сумму. Попробуйте добавить больше товара, чем доступно.
	- Проверьте, можно ли переместить товар из вашего списка желаний или корзины в корзину другого пользователя или удалить из неё.

- Тестирование комментариев в теме
	- Проверьте, есть ли ограничение на количество комментариев в теме.
	- Если пользователь может оставить только один комментарий, используйте условия гонки, чтобы проверить, можно ли опубликовать несколько комментариев.
	- Если система разрешает комментарии от проверенных или привилегированных пользователей, попробуйте имитировать эти параметры и проверьте, сможете ли вы оставлять комментарии.
	- Попытайтесь опубликовать комментарии от имени других пользователей.


### Предоставление оракула шифрования

> Контролируемые пользователем входные данные шифруются, а полученный зашифрованный текст затем каким-то образом предоставляется пользователю.
> Если на сайте есть другой контролируемый пользователем вход, который обеспечивает обратную функцию - это позволит расшифровать другие данные, чтобы определить ожидаемую структуру.

### Несоответствия парсера адресов электронной почты

> Некоторые веб-сайты анализируют адреса электронной почты, чтобы извлечь домен и определить, к какой организации принадлежит владелец электронной почты.

=?utf-8?q?=61=62=63?=foo@ginandjuice.shop



# **Защита**
* Убедитесь, что разработчики и тестировщики понимают домен, который обслуживает приложение
* Избегайте делать неявные предположения о поведении пользователя или поведении других частей приложения
* Вы должны определить, какие предположения вы сделали о состоянии на стороне сервера, и реализовать необходимую логику для проверки того, что эти предположения выполняются. Это включает в себя проверку того, что значение любого ввода разумно, прежде чем продолжить.
* Главное правило, которое поможет избегать логических ошибок, — воспринимать приложение как систему, где все элементы связаны. При разработке, обновлении или поиске уязвимостей необходимо отслеживать взаимосвязи отдельных частей и искать логические несостыковки.


# URL

* https://portswigger.net/research/splitting-the-email-atom
* https://www.hackerone.com/blog/how-business-logic-vulnerability-led-unlimited-discount-redemption
* https://hackerone.com/reports/1849626
